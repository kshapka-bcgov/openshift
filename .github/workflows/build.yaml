name: Build API Image.
on:
  push:
    branches:
      - development
    paths:
      - "src/**"

  workflow_dispatch:
defaults:
  run:
    working-directory: ./
jobs:
  deploy_api_on_openshift:
    if: github.repository_owner == 'kshapka-bcgov'
    runs-on: ubuntu-latest
    steps:
      - name: Curl message to notify repo has been updated.
        uses: redhat-developer/openshift-actions@v1.1
        with:
          version: "latest"
          openshift_server_url: ${{ secrets.OpenShiftServerURL }}
          parameters: '{"apitoken": "${{ secrets.OpenShiftToken }}", "acceptUntrustedCerts": "true"}'
          cmd: |
            oc project c345c5-tools
            oc create curl-pipeline -p url-secret=rocketchat-url -p options=curl -X POST -H 'Content-Type: application/json' --data '{"alias":"DESCW OC Alerts","text":"Example message","attachments":[{"title":"Rocket.Chat","title_link":"https://rocket.chat","text":"Rocket.Chat, the best open source chat","image_url":"https://chat.developer.gov.bc.ca/images/integration-attachment-example.png","color":"#764FA5"}]}' https://chat.developer.gov.bc.ca/hooks/65fdf0d02fd4ac4864efdd7f/tCbPXbzhCmxF6swtadmW4zajtgHpguX62cMLTN4naa239sr6